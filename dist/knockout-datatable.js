"use strict";var _slicedToArray=function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var t,o=[],i=e[Symbol.iterator]();!(t=i.next()).done&&(o.push(t.value),!r||o.length!==r););return o}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function e(e,r){for(var t in r){var o=r[t];o.configurable=!0,o.value&&(o.writable=!0)}Object.defineProperties(e,r)}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),_classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},unwrapObservable=ko.utils.unwrapObservable,primitiveCompare=function(e,r){return null===r||void 0===r?null===e||void 0===e:null!==e&&void 0!==e?"boolean"==typeof e?e===r:e.toString().toLowerCase().indexOf(r.toString().toLowerCase())>=0||e===r:!1},obsComparer=function(e,r){var t=ko.isObservable(e)?e():e;return primitiveCompare(t,r)},ClientSidePaginationHandler=function(){function e(r){var t=this;_classCallCheck(this,e),this.sortDir=void 0,this.sortField=void 0,this.perPage=void 0,this.currentPage=void 0,this.filter=void 0,this.rebuildRowAttributeMap(r);var o=function(e,r,t){return function(){var e=[],r=!0,o=!1,i=void 0;try{for(var n,a=t[Symbol.iterator]();!(r=(n=a.next()).done);r=!0){var s=_slicedToArray(n.value,2),u=s[1];e.push(u)}}catch(l){o=!0,i=l}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return e}().some(function(t){var o=r[t];return ko.isObservable(o)?primitiveCompare(o(),e):primitiveCompare(o,e)})};this.filterFn=function(e){var r=new Map,i=[];return e.split(" ").forEach(function(e){if(e.indexOf(":")>=0){var t=e.split(":");switch(t[1].toLowerCase()){case"yes":case"true":r.set(t[0],!0);break;case"no":case"false":r.set(t[0],!1);break;case"blank":case"none":case"null":case"undefined":r.set(t[0],void 0);break;default:r.set(t[0],t[1].toLowerCase())}}else i.push(e)}),i=i.join(" "),function(e){if(""===i)return!0;var n=function(){var n=t.rowAttributeMap,a=new Map(function(){var e=[],t=!0,o=!1,i=void 0;try{for(var a,s=r[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var u=_slicedToArray(a.value,2),l=u[0],c=u[1];e.push([n[l.toLowerCase()],c])}}catch(d){o=!0,i=d}finally{try{!t&&s["return"]&&s["return"]()}finally{if(o)throw i}}return e}()),s=function(){var r=[],t=!0,o=!1,i=void 0;try{for(var n,s=a[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var u=_slicedToArray(n.value,2),l=u[0],c=u[1];r.push(l?obsComparer(e[l],c):!1)}}catch(d){o=!0,i=d}finally{try{!t&&s["return"]&&s["return"]()}finally{if(o)throw i}}return r}();return-1===s.indexOf(!1)?"function"==typeof e.match?{v:e.match(i)}:{v:o(i,e,n)}:{v:!1}}();return"object"==typeof n?n.v:void 0}}}return _createClass(e,{rebuildRowAttributeMap:{value:function(e){var r=function(){var r=e[0];return r?new Map(function(){var e=[],t=!0,o=!1,i=void 0;try{for(var n,a=Object.keys(r)[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var s=n.value;r.hasOwnProperty(s)&&e.push([s.toLowerCase(),s])}}catch(u){o=!0,i=u}finally{try{!t&&a["return"]&&a["return"]()}finally{if(o)throw i}}return e}()):new Map};this.rowAttributeMap=r()}},filterRows:{value:function(e){var r=void 0;return r=""!==this.filter?e.filter(this.filterFn(this.filter)):e,Promise.resolve(r)}},sortRows:{value:function(e){var r=this,t=e.slice(0);if(!this.sortField&&0!==this.sortField)return Promise.resolve(t);var o=function(e,t){var o=[e,t].map(function(e){var t=unwrapObservable(e[r.sortField]);return"string"==typeof t&&(t=t.toLowerCase()),t}),i=_slicedToArray(o,2),n=i[0],a=i[1];return"asc"===r.sortDir?a>n||""===n||null===n||void 0===n?-1:n>a||""===a||null===a||void 0===a?1:0:a>n||""===n||null===n||void 0===n?1:n>a||""===a||null===a||void 0===a?-1:0};return t.sort(o),Promise.resolve(t)}},pageRows:{value:function(e){var r=this.currentPage-1,t=this.perPage,o=e.slice(r*t,(r+1)*t);return Promise.resolve({pagedRows:o,totalNumRows:e.length})}},getData:{value:function(e){var r=this;return this.filterRows(e).then(function(e){return r.sortRows(e)}).then(function(e){return r.pageRows(e)}).then(function(e){var t=e.pagedRows,o=e.totalNumRows;return Promise.resolve({numPages:Math.ceil(o/r.perPage),numFilteredRows:o,pagedRows:t})})}}}),e}(),_createClass=function(){function e(e,r){for(var t in r){var o=r[t];o.configurable=!0,o.value&&(o.writable=!0)}Object.defineProperties(e,r)}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),_classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},pureComputed=ko.pureComputed||ko.computed;window.DataTable=function(){function e(r,t){_classCallCheck(this,e),t||(r instanceof Array?t={}:(t=r,r=[]));var o=t.serverSidePagination;this.rows=r.slice(0),this.options={recordWord:t.recordWord||"record",recordWordPlural:t.recordWordPlural||(t.recordWord||"record")+"s",sortDir:t.sortDir||"asc",sortField:t.sortField||void 0,perPage:t.perPage||15,filterFn:t.filterFn||void 0,unsortedClass:t.unsortedClass||"",descSortClass:t.descSortClass||"",ascSortClass:t.ascSortClass||"",rateLimitTimeout:t.rateLimitTimeout||void 0},this.numPages=ko.observable(void 0),this.numFilteredRows=ko.observable(void 0),this.pagedRows=ko.observable(void 0),this.firstRecordIndex=ko.observable(void 0),this.lastRecordIndex=ko.observable(void 0),this.sortDir=ko.observable(this.options.sortDir),this.sortField=ko.observable(this.options.sortField),this.perPage=ko.observable(this.options.perPage),this.currentPage=ko.observable(1),this.filter=ko.observable(""),this.loading=ko.observable(!1),o&&o.enabled?(this.options.serverSidePaginationEnabled=!0,this.options.rateLimitTimeout||0===this.options.rateLimitTimeout||(this.options.rateLimitTimeout=500),this.registerPaginationHandler(new ServerSidePaginationHandler(o))):this.registerPaginationHandler(new ClientSidePaginationHandler(this.rows))}return _createClass(e,{registerPaginationHandler:{value:function(e){var r=this;this.handler=e;var t=["sortDir","sortField","perPage","currentPage","filter"],o=ko.computed(function(){t.forEach(function(t){e[t]=r[t]()}),r.refreshData()});(this.options.rateLimitTimeout||0===this.options.rateLimitTimeout)&&o.extend({rateLimit:{timeout:this.options.rateLimitTimeout,method:"notifyWhenChangesStop"}})}},toggleSort:{value:function(e){var r=this;return function(){r.currentPage(1),r.sortField()===e?r.sortDir("asc"===r.sortDir()?"desc":"asc"):(r.sortDir("asc"),r.sortField(e))}}},onLastPage:{value:function(){return this.currentPage()===this.numPages()}},onFirstPage:{value:function(){return 1===this.currentPage()}},moveToPrevPage:{value:function(){this.onFirstPage()?this.refreshData():this.currentPage(this.currentPage()-1)}},moveToNextPage:{value:function(){this.onLastPage()?this.refreshData():this.currentPage(this.currentPage()+1)}},moveToPage:{value:function(e){var r=this;return function(){r.currentPage(e)}}},recordIndexes:{get:function(){var e=(this.currentPage()-1)*this.perPage()+1,r=this.currentPage()*this.perPage(),t=this.numFilteredRows();return r>t&&(r=t),{firstRecordIndex:e,lastRecordIndex:r}}},refreshData:{value:function(){var e=this;this.loading(!0),this.handler.getData(this.rows).then(function(r){var t=r.numPages,o=r.numFilteredRows,i=r.pagedRows;e.numPages(t),e.numFilteredRows(o);var n=e.recordIndexes;e.pagedRows(i),e.firstRecordIndex(n.firstRecordIndex),e.lastRecordIndex(n.lastRecordIndex),e.loading(!1)})["catch"](function(e){throw e})}},addRecord:{value:function(e){if(this.options.serverSidePaginationEnabled)throw new Error("#addRecord() not applicable with serverSidePagination enabled");this.rows.push(e),this.refreshData()}},removeRecord:{value:function(e){if(this.options.serverSidePaginationEnabled)throw new Error("#removeRecord() not applicable with serverSidePagination enabled");var r=this.rows.indexOf(e);if(-1===r)throw new Error("Could not remove record; record not found");this.rows.splice(r,1),this.onLastPage()&&1===this.pagedRows().length?this.moveToPrevPage():this.refreshData()}},replaceRows:{value:function(e){if(this.options.serverSidePaginationEnabled)throw new Error("#replaceRows() not applicable with serverSidePagination enabled");this.rows=e.slice(0),this.currentPage(1),this.filter(void 0)}},pageClass:{value:function(e){var r=this;return pureComputed(function(){return r.currentPage()===e?"active":void 0})}},leftPagerClass:{get:function(){var e=this;return pureComputed(function(){return 1===e.currentPage()?"disabled":void 0})}},rightPagerClass:{get:function(){var e=this;return pureComputed(function(){return e.currentPage()===e.numPages()?"disabled":void 0})}},recordsText:{get:function(){var e=this;return pureComputed(function(){var r=e.numPages(),t=e.numFilteredRows(),o=e.firstRecordIndex(),i=e.lastRecordIndex(),n=e.options.recordWord,a=e.options.recordWordPlural;return r>1?""+o+" to "+i+" of "+t+" "+a:""+t+" "+(t>1||0===t?a:n)})}},showNoData:{get:function(){var e=this;return pureComputed(function(){var r=e.pagedRows();return r?!r.length&&!e.loading():!0})}},showLoading:{get:function(){var e=this;return pureComputed(function(){return e.loading()})}},sortClass:{value:function(e){var r=this;return pureComputed(function(){return r.sortField()===e?"asc"===r.sortDir()?r.options.ascSortClass:r.options.descSortClass:r.options.unsortedClass})}}}),e}();var _slicedToArray=function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var t,o=[],i=e[Symbol.iterator]();!(t=i.next()).done&&(o.push(t.value),!r||o.length!==r););return o}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function e(e,r){for(var t in r){var o=r[t];o.configurable=!0,o.value&&(o.writable=!0)}Object.defineProperties(e,r)}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),_classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},ServerSidePaginationHandler=function(){function e(r){var t=r.path,o=r.loader;if(_classCallCheck(this,e),!t||!o)throw new Error("`path` or `loader` missing from `serverSidePagination` object");this.paginationPath=t,this.resultHandlerFn=o,this.sortDir=void 0,this.sortField=void 0,this.perPage=void 0,this.currentPage=void 0,this.filter=void 0}return _createClass(e,{getData:{value:function(){var e=this;return new Promise(function(r,t){var o=(new Map).set("perPage",e.perPage).set("page",e.currentPage).set("filter",e.filter||0===e.filter?e.filter:void 0);!e.sortField&&0!==e.sortField||!e.sortDir&&0!==e.sortDir||o.set("sortDir",e.sortDir).set("sortField",e.sortField);var i=""+e.paginationPath+"?"+function(){var e=[],r=!0,t=!1,i=void 0;try{for(var n,a=o[Symbol.iterator]();!(r=(n=a.next()).done);r=!0){var s=_slicedToArray(n.value,2),u=s[0],l=s[1];(l||0===l)&&e.push(""+encodeURIComponent(u)+"="+encodeURIComponent(l))}}catch(c){t=!0,i=c}finally{try{!r&&a["return"]&&a["return"]()}finally{if(t)throw i}}return e}().join("&"),n=new XMLHttpRequest;n.open("GET",i,!0),n.setRequestHeader("Content-Type","application/json"),n.onload=function(){n.status>=200&&n.status<400?r(JSON.parse(n.responseText)):t(new Error("Error communicating with server"))},n.onerror=t,n.send()}).then(function(r){return new Promise(function(t,o){(r.total||0===r.total)&&r.results?t({numFilteredRows:r.total,numPages:Math.ceil(r.total/e.perPage),pagedRows:r.results.map(e.resultHandlerFn)}):o(new Error("Server response missing either `total` or `results` (or both)"))})})}}}),e}();
//# sourceMappingURL=knockout-datatable.js.map